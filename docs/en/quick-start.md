We will use a simple Demo to illustrate the powerful functions of Easy-Es. Before that, we assume that you have

● Have a Java development environment and corresponding IDE

● Familiar with MySQL

● Familiar with Spring Boot

● Familiar with Maven

● Understand the basic concepts of Es

● Es is installed Recommended version 7.x+  (you can search for tutorials on Google if you don't have it, it is recommended to install another [es-head plugin](https://github.com/mobz/elasticsearch-head))

> **TIP**
> If you are too lazy to read the following tutorials, you can also download the [Springboo integrated demo](/en/demo.md) and run it directly

## Initialize the project

---

Create an empty Spring Boot project
> **TIP**
> You can use [Spring Initializer](https://start.spring.io/) to quickly initialize a Spring Boot project

## Add dependency

---

**Maven:**
```xml
        <dependency>
            <groupId>io.github.xpc1024</groupId>
            <artifactId>easy-es-boot-starter</artifactId>
            <version>Latest Version</version>
        </dependency>
```
**Gradle:**
```groovy
compile group: 'io.github.xpc1024', name: 'easy-es-boot-starter', version: 'Latest Version'
```
> **Tips:** Latest Version: [Click here to get the latest version](https://img.shields.io/github/v/release/xpc1024/easy-es?include_prereleases&logo=xpc&style=plastic)

## Configuration

---

Add the necessary configuration of EasyEs in the application.yml configuration file:
```yaml
easy-es:
  eanble: true # The default value is true, If the value of enable is false, it is considered that Easy-es is not enabled
  address: 127.0.0.0:9200 # Your elasticsearch address,must contains port, If it is a cluster, please separate with',' just like this: 127.0.0.0:9200,127.0.0.1:9200
  username: elastic # Es username, Not necessary, If it is not set in your elasticsearch, delete this line
  password: WG7WVmuNMtM4GwNYkyWH # Es password, Not necessary, If it is not set, delete this line
```
> Other configurations can be omitted temporarily, the following chapters will introduce the configuration of EasyEs in detail

Add the @EsMapperScan annotation to the Spring Boot startup class to scan the Mapper folder:
```java
@SpringBootApplication
@EsMapperScan("com.xpc.easyes.sample.mapper")
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }

}
```
## backgrounds

---

There is currently a Document table. As the amount of data expands, its query efficiency can no longer meet product requirements. The table structure is as follows. We plan to migrate the content of this table to the Elasticsearch to improve query efficiency.

| id | title | content |
| --- | --- | --- |

## coding

---

Write the entity class Document.java ([Lombok](https://www.projectlombok.org/) is used here to simplify the code)
```java
@Data
public class Document {
    /**
     * just like the primary key in MySQL
     */
    private String id;

    /**
     * title of document
     */
    private String title;
    /**
     * content of document
     */
    private String content;

    /**
     * creator of document
     */
    private String creator;
}
```
> **Tips:** If there is no annotation and global configuration for the above field id, its strategy is automatically generated by Es by default. The corresponding field in es is'_id', and the field type is String. If you need to perform special processing on the id, it will be introduced in the subsequent chapters. How to configure Id.

Write the Mapper class DocumentMapper.java
```java
public interface DocumentMapper extends BaseEsMapper<Document> {
}
```
## Get started (CRUD)

---

Add test class to perform functional test:
> Pre-operation: Create an index (equivalent to a table in MySQL, must exists the table before subsequent CRUD)

```java
import com.xpc.easyes.core.enums.FieldType;
@SpringBootTest(classes = EasyEsApplication.class)
public class SearchTest {
    
    @Resource
    DocumentMapper documentMapper;
    
    @Test
    public void testCreatIndex() {
        // Test to create an index If you don’t understand the concept of Es index, please understand it first. A lazy man can be simply understood as a table in MySQL.
        LambdaEsIndexWrapper<Document> wrapper = new LambdaEsIndexWrapper<>();
        
        // For the sake of simplicity, use the class name as the index name directly. The following chapters will teach you how to configure and use the index more flexibly.
        wrapper.indexName(Document.class.getSimpleName().toLowerCase());
        
        // Here, the article title is mapped to the keyword type (word segmentation is not supported), and the document content is mapped to the text type (word segmentation query is supported)
        wrapper.mapping(Document::getTitle, FieldType.KEYWORD)
                .mapping(Document::getContent, FieldType.TEXT);
 
        boolean isOk = documentMapper.createIndex(wrapper);
       	Assert.assertTrue(isOk);
        // Expected value: true If it is true, it proves that the index has been successfully created
    }
    
}
```
> **Test insert:** Add a new piece of data (equivalent to the Insert operation in MySQL)

```java
    @Test
    public void testInsert() {
        // Test insert data
        Document document = new Document();
        document.setTitle("Hello");
        document.setContent("World");
        document.setCreator("Guy")
        String id = documentMapper.insert(document);
        System.out.println(id);
    }
```
> Test query: query the specified data according to the conditions (equivalent to the Select operation in MySQL)

```java
    @Test
    public void testSelect() {
        // test query
        String title = "Hello";
        LambdaEsQueryWrapper<Document> wrapper = new LambdaEsQueryWrapper<>();
        wrapper.eq(Document::getTitle,title);
        Document document = documentMapper.selectOne(wrapper);
        System.out.println(document);
        Assert.assertEquals(title,document.getTitle());
    }
```
> Test update: update data (equivalent to the Update operation in MySQL)

```java
    @Test
    public void testUpdate() {
        // There are two cases of update, which are demonstrated as follows:
        // case1: Known id, update according to id (for the convenience of demonstration, this id is copied from the query in the previous step, the actual business can be queried by yourself)
        String id = "krkvN30BUP1SGucenZQ9";
        String title1 = "Nice";
        Document document1 = new Document();
        document1.setId(id);
        document1.setTitle(title1);
        documentMapper.updateById(document1);

        // case2: id unknown, update according to conditions
        LambdaEsUpdateWrapper<Document> wrapper = new LambdaEsUpdateWrapper<>();
        wrapper.eq(Document::getTitle,title1);
        Document document2 = new Document();
        document2.setTitle("Bad");
        documentMapper.update(document2,wrapper);
    }
```
Through the update, the data title is first updated to Nice, and finally updated to Bad.

> Test delete: delete data (equivalent to the Delete operation in MySQL)

```java
    @Test
    public void testDelete() {
        // There are two cases for deletion: delete according to id or delete according to conditions
        // Considering that id deletion is too simple, here is only a demonstration of deletion based on conditions
        LambdaEsQueryWrapper<Document> wrapper = new LambdaEsQueryWrapper<>();
        String title = "Bad";
        wrapper.eq(Document::getTitle,title);
        int successCount = documentMapper.delete(wrapper);
        System.out.println(successCount);
    }
```
> **TIP**
> Please move to the complete code sample: [Easy-Es-Sample](https://github.com/xpc1024/easy-es/tree/main/easy-es-sample) (test directory)
> We are sorry that currently only the Chinese version is provided, but the code itself is the same

## summary

---

Through the above few simple steps, we have realized Document index creation and CRUD function

From the above steps, we can see that integrating Easy-Es is very simple, just import the starter project and configure the mapper scan path.

But the power of Easy-Es is far more than these functions. Want to learn more about the powerful functions of Easy-Es? Then continue browsing!
